<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PxF Log In</title>
  <script src="Login.js"></script>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@700&family=Libre+Baskerville&display=swap"
    rel="stylesheet">
</head>

<style>
    body {
        text-align: center;
    }

    .container{
        justify-content:center;
        align-items:center;
        height:100vh;
        color: #f5f5f5;
        flex-direction: column;
        gap: 0
        
    }

    h1 {
        color: black;
    }
</style>

<body style=" background: #88A0B2">
    
    <div id="LOG IN CONTAINER" class="container" style="display: flex;">
        <span style="position: absolute; width: 600px; height: 500px; background: #f0f0f0"></span>
        <span style="position: relative; width: 560px; height: 400px; background: #ffffff" ></span>
        <span style="position: relative; width: 560px; height: 60px; background: #f0f0f0" ></span>
        
        <div id="box" style="position: absolute; height: 360px; display: flex; flex-direction: row; ">
            <div id="text-form" style="position: absolute; display:flex; flex-direction: column; text-align: left">              
                <span style="color: black; font-size: 26px; font-family: IBM Plex Sans; font-weight: 700;">PHOTO<br/></span>
                <span style="color: black; font-size: 24px; font-family: Libre Baskerville; font-style: italic; font-weight: 400;">xFOREVER</span>
                <span style="height: 60px"></span>
                

                <form style="display:flex; flex-direction: column; ">
                    <div style="display:flex; flex-direction: row; ">
                        <span style="color: black; font-size: 40px; font-family: Libre Baskerville; font-weight: 700; white-space: nowrap;">Log In</span>
                        <span style="width: 275px"></span>

                        <input type="submit" value="→" onclick="loginUser();" style="width: 40px; height: 40px; background: black; color: white; border: none; border-radius: 10px; cursor: pointer;">

                    </div>
                    <span style="height: 30px"></span>
                    <span style="color: #858585; font-size: 13px; font-family: Libre Baskerville; font-weight: 400; ">Username</span>
                    <input type="text" id="login-username" style="width: 300px; height: 20px; border: none; border-bottom: 2px solid #F5F5F5;" required>
                    <span style="height: 20px"></span>
                    <span style="color: #858585; font-size: 13px; font-family: Libre Baskerville; font-weight: 400; ">Password</span>
                    <input type="password" id="login-password" style="width: 300px; height: 20px; border: none; border-bottom: 2px solid #F5F5F5;" required>
                    <span style="height: 20px"></span>
                    <span id="wrong" style="font-size: 13px; font-family: Libre Baskerville; font-weight: 400; word-wrap: break-word"></span>
                </form>
            </div>
            
            <span style="width: 450px"></span>
        </div>

        <div id="selection" style="position: absolute; flex-direction: column;">
            <span style="height: 420px; display: flex; "></span>
            <div style= "border-radius: 10px; width: 240px; height: 40px; display: flex; flex-direction: row; background: black; justify-content:center">
                <button onclick="showSignup()" style="color: white; font-size: 13px; font-family: IBM Plex Sans; background-color: black; border: none;">SIGN UP</button>
                <span style="width: 40px"></span>

                <button onclick="loginGuest()" style="color: white; font-size: 13px; font-family: IBM Plex Sans; background-color: black; border: none;">GUEST</button>
            </div>
            
        </div>          
    
    </div>

    <div id="SIGN UP CONTAINER" class="container" style="display: none;">
        <span style="position: absolute; width: 600px; height: 500px; background: #f0f0f0"></span>
        <span style="position: relative; width: 560px; height: 400px; background: #ffffff" ></span>
        <span style="position: relative; width: 560px; height: 60px; background: #f0f0f0" ></span>
        
        <div id="box" style="position: absolute; height: 390px; display: flex; flex-direction: row; ">
            <div id="text-form" style="position: absolute; display:flex; flex-direction: column; text-align: left">              
                <span style="color: black; font-size: 26px; font-family: IBM Plex Sans; font-weight: 700;">PHOTO<br/></span>
                <span style="color: black; font-size: 24px; font-family: Libre Baskerville; font-style: italic; font-weight: 400;">xFOREVER</span>
                <span style="height: 30px"></span>
                

                <form style="display:flex; flex-direction: column; ">
                    <div style="display:flex; flex-direction: row; ">
                        <span style="color: black; font-size: 40px; font-family: Libre Baskerville; font-weight: 700; white-space: nowrap;">Sign Up</span>
                        <span style="width: 275px"></span>

                        <input type="submit" value="→" onclick="registerUser();" style="width: 40px; height: 40px; background: black; color: white; border: none; border-radius: 10px; cursor: pointer;">

                    </div>
                    <span style="height: 30px"></span>
                    <span style="color: #858585; font-size: 13px; font-family: Libre Baskerville; font-weight: 400; ">Username</span>
                    <input type="text" id="signup-username" style="width: 300px; height: 20px; border: none; border-bottom: 2px solid #F5F5F5;" required>
                    <span style="height: 20px"></span>
                    <span style="color: #858585; font-size: 13px; font-family: Libre Baskerville; font-weight: 400; ">Password</span>
                    <input type="password" id="signup-password" style="width: 300px; height: 20px; border: none; border-bottom: 2px solid #F5F5F5;" required>
                    <span style="height: 20px"></span>
                    <span style="color: #858585; font-size: 13px; font-family: Libre Baskerville; font-weight: 400; ">Confirm Password</span>
                    <input type="password" id="signup-password-confirm" style="width: 300px; height: 20px; border: none; border-bottom: 2px solid #F5F5F5;" required>
                    <span style="height: 20px"></span>
                </form>
            </div>
            
            <span style="width: 450px"></span>
        </div>

        <div id="selection" style="position: absolute; flex-direction: column;">
            <span style="height: 420px; display: flex; "></span>
            <div style= "border-radius: 10px; width: 240px; height: 40px; display: flex; flex-direction: row; background: black; justify-content:center">
                <button onclick="showLogin()" style="color: white; font-size: 13px; font-family: IBM Plex Sans; background-color: black; border: none;">LOG IN</button>
                <span style="width: 40px"></span>

                <button onclick="loginGuest()" style="color: white; font-size: 13px; font-family: IBM Plex Sans; background-color: black; border: none;">GUEST</button>
            </div>
            
        </div>          
    
    </div>

</body>

<script>
    function showSignup(){
        document.getElementById("LOG IN CONTAINER").style.display = "none";
        document.getElementById("SIGN UP CONTAINER").style.display = "flex";
    }

    function showLogin(){
        document.getElementById("LOG IN CONTAINER").style.display = "flex";
        document.getElementById("SIGN UP CONTAINER").style.display = "none";
    }

    function loginUser(){
        let url="http://localhost:8080/201_NewProject/LoginServlet?user="
        +document.getElementById(login.username).value+"&pass="+document.getElementById(login.password).value;
        
        fetch(url, {method:"POST"})
        .then(response=> response.text())
        .then((result) => {
            
            if (Number.isNaN(parseInt(result))){
                
                document.getElementById("wrong").innerHTML=result;
            } else {
                //result is the user id, store user id in local storage
                //change page to the logged in view
                
                sessionStorage.setItem("userID", result);
                window.location.assign("map.html");
            }
            
        
        
        }).catch(function(error){
        
                console.log("request failed", error)
        });
    }

    async function registerUser(){	
	var username = document.getElementById("signup-username").value;
	var pass = document.getElementById("signup-password").value;
    var confirmPass = document.getElementById("signup-password-confirm").value;
    
	if (username == ""){
		alert("Username field must not be empty.");
		return;
	}
	
	console.log(username);
    console.log(pass);
    console.log(confirmPass);
    
    if (pass == "" || confirmPass == ""){
		alert("Password or Confirm Password field must not be empty.");
		return;
	}
	
	if (confirmPass != pass){
		alert("Passwords do not match. Try again.");
		return;
	}
	
	// Convert JS info into JSON
	const userData = {
		user: username,
		pass: pass,
	};
	
	console.log(userData);
	
	const jsonData = JSON.stringify(userData);
	console.log(jsonData);
	
	// Took lines 38-70 from Kathy's Assignment 4
	try{
		const response = await fetch('/knhang_CSCI201_Assignment4/RegisterUserServlet', { // Have to change this line
	    method: 'POST',
	    headers: {
	      'Content-Type': 'application/json'
	    },
	    body: jsonData
        });
        
        const data = await response.json();
        console.log(data);
        if (data == "Username is taken."){
			alert("Username is already taken.");
			return;
		}
		else if(data == "User information is missing."){
			alert("User information is missing.");
			return;
		}
		else{
			// BREH HOW DO I USE COOKIES
        	localStorage.setItem("userID", data);
        	window.location.href = "home.html";
		}
    }
    catch (error){
		console.error('Error:', error);
	}
}
</script>

</html>
